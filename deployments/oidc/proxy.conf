upstream application {
  server application:80;
}
upstream orchestrator {
  server orchestrator:8080;
}

server {
  server_name proxy;
  listen                    8080;
  absolute_redirect off; # have Location header specify path only

  location / {
    proxy_pass http://application;
  }
  location /new {
    # redirect browser to OIDC Client on /
    # this is needed for the OIDC client to work
    return 301 /;
  }
  location /orca {
    # rewrite /(...) to /
    # also have it work when there's no trailing slash
    rewrite ^/orca(/.*)$ $1 break;
    proxy_pass http://orchestrator;
  }
}